<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #f3f5f9; margin: 0; padding: 20px; color: #15283c; }
        .container { max-width: 600px; margin: 0 auto; }
        .card { background: #fff; border-radius: 15px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h1 { text-align: center; color: #1e56a0; font-size: 24px; margin-top: 0; }
        #reader { width: 100%; border-radius: 12px; overflow: hidden; border: 2px solid #eef2f5; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡πÑ‡∏ï‡∏•‡πå Pluto */
        .result-box { display: none; align-items: center; background: #e8f5e9; padding: 15px; border-radius: 12px; border-left: 6px solid #28a745; margin-top: 20px; animation: fadeIn 0.5s;}
        .result-box img { width: 60px; height: 60px; border-radius: 50%; margin-right: 15px; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
        .result-info h3 { margin: 0 0 5px 0; color: #15283c; font-size: 18px;}
        .result-info p { margin: 0; color: #64748b; font-size: 14px;}
        .status-badge { background: #28a745; color: white; padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-block; margin-bottom: 5px;}
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .loading { text-align: center; color: #f59e0b; font-weight: 600; display: none; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h1>üè´ ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
        <p style="text-align: center; color: #64748b; font-size: 14px; margin-bottom: 20px;">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</p>
        
        <div id="reader"></div>
        <div id="loading" class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>

        <div id="result-box" class="result-box">
            <img id="student-img" src="" alt="Avatar">
            <div class="result-info">
                <div class="status-badge" id="status-badge">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                <h3 id="student-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <p>‡∏£‡∏´‡∏±‡∏™: <b id="student-id">...</b> | ‡∏ä‡∏±‡πâ‡∏ô: <b id="student-class">...</b></p>
            </div>
        </div>
    </div>
</div>

<script>
    // üî¥ ‡∏ô‡∏≥ URL ‡∏Ç‡∏≠‡∏á Web App ‡∏ó‡∏µ‡πà‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡∏°‡∏≤‡∏à‡∏≤‡∏Å Step 1 ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö üî¥
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbz6VW3zOcb_EZvFPZr7Kbf-WIwz_b21v4_L-OfydkWuGj2KynXjsUPr7ALoJZyADw-w/exec";

    let lastScannedId = "";
    let lastScanTime = 0;

    function onScanSuccess(decodedText, decodedResult) {
        let now = Date.now();
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô‡∏ã‡πâ‡∏≥‡∏Ñ‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 4 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        if (decodedText === lastScannedId && (now - lastScanTime) < 4000) {
            return; 
        }
        
        lastScannedId = decodedText;
        lastScanTime = now;

        // ‡∏ã‡πà‡∏≠‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÄ‡∏Å‡πà‡∏≤ ‡πÇ‡∏ä‡∏ß‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
        document.getElementById('result-box').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà Google Sheets ‡∏ú‡πà‡∏≤‡∏ô API
        fetch(GAS_API_URL + "?id=" + encodeURIComponent(decodedText))
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                
                if(data.status === "success") {
                    // ‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î
                    document.getElementById('student-name').innerText = data.name;
                    document.getElementById('student-id').innerText = data.id;
                    document.getElementById('student-class').innerText = data.className;
                    
                    // ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    let imgUrl = `https://ui-avatars.com/api/?name=${data.name}&background=random&color=fff&rounded=true&size=128`;
                    document.getElementById('student-img').src = imgUrl;
                    
                    document.getElementById('result-box').style.display = 'flex';
                } else {
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + data.message);
                }
            })
            .catch(error => {
                document.getElementById('loading').style.display = 'none';
                alert("‡∏™‡πÅ‡∏Å‡∏ô‡∏ï‡∏¥‡∏î ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
            });
    }

    // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    let html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: {width: 250, height: 250}, videoConstraints: { facingMode: "environment" } }, false);
    html5QrcodeScanner.render(onScanSuccess, function(error){});
</script>

</body>

</html>
