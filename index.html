<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS BCW - ‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #1e56a0; --bg: #f3f5f9; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; padding: 0; padding-bottom: 80px; }
        .navbar { background: var(--primary); color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .nav-menu { position: fixed; bottom: 0; width: 100%; background: white; display: none; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ddd; z-index: 1000;}
        .nav-item { text-align: center; font-size: 13px; color: #64748b; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Prompt'; width: 100%; box-sizing: border-box; margin-bottom: 10px;}
        button { padding: 10px 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-family: 'Prompt'; font-weight: bold;}
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á/‡πÅ‡∏ñ‡∏ß‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ */
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;}
        .date-picker { padding: 8px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Prompt'; font-size: 14px; margin-bottom:0; width:auto;}
        .student-row { display: flex; flex-direction: column; background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; margin-bottom: 15px; transition: 0.3s; }
        .student-info { display: flex; align-items: center; margin-bottom: 10px; }
        .student-number { font-size: 18px; font-weight: bold; color: #64748b; width: 40px; text-align: center; }
        .img-container { position: relative; width: 60px; height: 60px; margin-right: 15px; }
        .student-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
        .upload-btn { position: absolute; bottom: -5px; right: -5px; background: var(--primary); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-size: 12px; cursor: pointer; display: flex; justify-content: center; align-items: center;}
        .student-name { flex-grow: 1; font-size: 16px; font-weight: 600; color: #15283c; }
        .status-group { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;}
        .btn-status { flex: 1; padding: 8px 5px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; font-family: 'Prompt'; font-size: 14px; transition: 0.2s; text-align: center; font-weight: bold; color: #666;}
        .behavior-note { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Prompt'; font-size: 13px; box-sizing: border-box; resize: vertical; min-height: 40px;}
        .status-present.active { background-color: #28a745; color: white; border-color: #28a745; }
        .status-sick.active { background-color: #dc3545; color: white; border-color: #dc3545; }
        .status-leave.active { background-color: #ffc107; color: #000; border-color: #ffc107; }
        .status-absent.active { background-color: #fd7e14; color: white; border-color: #fd7e14; }
        .row-present { background-color: #e8f5e9; border-left: 6px solid #28a745; }
        .row-sick { background-color: #ffebee; border-left: 6px solid #dc3545; }
        .row-leave { background-color: #fff8e1; border-left: 6px solid #ffc107; }
        .row-absent { background-color: #fff3e0; border-left: 6px solid #fd7e14; }
        .save-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Prompt'; margin-top: 10px;}

        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; background: white;}
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; }
        
        .stat-grid { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;}
        .stat-card { flex: 1; min-width:80px; padding: 15px; border-radius: 10px; color: white; text-align: center; }
        .stat-blue { background: linear-gradient(135deg, #1e56a0, #2a6fcc); }
        .stat-green { background: linear-gradient(135deg, #28a745, #34ce57); }
        .stat-red { background: linear-gradient(135deg, #dc3545, #e4606d); }
        .stat-card h3 { margin: 0; font-size: 13px; opacity: 0.9; }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 24px; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏Å‡∏•‡πà‡∏≠‡∏á AI */
        .ai-box { background: #f0f7ff; border-left: 5px solid #1e56a0; padding: 15px; border-radius: 8px; margin-bottom: 20px;}
        .ai-box h3 { margin-top: 0; color: #1e56a0; display:flex; align-items:center; gap:8px; font-size:18px;}
        
        /* Exec Filters */
        .exec-filters { display:flex; gap:10px; flex-wrap:wrap; background:#fff; padding:15px; border-radius:10px; margin-bottom:15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05);}
        .exec-filters div { flex: 1; min-width:140px;}
        .exec-filters label { font-size:12px; color:#666; font-weight:bold; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: bold;">üè´ SIS ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</div>
    <div id="user-display" style="font-size: 12px; cursor: pointer;" onclick="logout()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
</div>

<div class="container">
    
    <div id="login-page" class="page active">
        <div class="card" style="text-align: center; max-width: 400px; margin: 40px auto;">
            <h2 style="color: #1e56a0;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <input type="text" id="username" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
            <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button id="login-btn" onclick="handleLogin()" style="width: 100%; font-size:16px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="student-page" class="page">
        <h2 style="color: #1e56a0;">üéì ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
        <div class="card stat-blue">
            <h3 id="st-name-display" style="margin:0; font-size: 20px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <p id="st-id-display" style="margin:5px 0 0 0; opacity: 0.9;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
        <div class="stat-grid">
            <div class="stat-card stat-green"><h3>‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3><h2 id="st-stat-present">0</h2></div>
            <div class="stat-card stat-red"><h3>‡∏Ç‡∏≤‡∏î</h3><h2 id="st-stat-absent">0</h2></div>
            <div class="stat-card" style="background:#f59e0b;"><h3>‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤</h3><h2 id="st-stat-leave">0</h2></div>
        </div>
        <div class="ai-box">
            <h3>ü§ñ ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢ AI ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°</h3>
            <p id="ai-assessment-text" style="color:#333; line-height:1.6; margin-bottom:0; font-size:14px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>
        <div class="card">
            <h3>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</h3>
            <div style="overflow-x: auto;">
                <table><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr></thead><tbody id="student-history-body"></tbody></table>
            </div>
        </div>
    </div>

    <div id="checklist-page" class="page">
        <div class="toolbar">
            <h2 style="margin: 0;">üìù ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ <span id="class-title" style="color:var(--primary);"></span></h2>
            <input type="date" id="check-date" class="date-picker">
        </div>
        <div id="student-list-container"></div>
        <button class="save-btn" id="save-btn" onclick="saveAttendance()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <div id="daily-page" class="page">
        <div class="card">
            <h2>üìÖ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
            <input type="date" id="view-date" class="date-picker" style="margin-bottom: 15px; width:100%;">
            <button onclick="loadDailyData()" style="width:100%; background: var(--primary);">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <table id="daily-table"><thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr></thead><tbody id="daily-body"><tr><td colspan='4' style='text-align:center;'>‡∏Å‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td></tr></tbody></table>
        </div>
    </div>

    <div id="summary-page" class="page">
        <div class="card">
            <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <button onclick="loadSummaryData()" style="width:100%; background: #28a745; margin-bottom: 15px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
            <table id="summary-table"><thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th style="color:#28a745;">‡∏°‡∏≤</th><th style="color:#dc3545;">‡∏õ‡πà‡∏ß‡∏¢</th><th style="color:#ffc107;">‡∏•‡∏≤</th><th style="color:#fd7e14;">‡∏Ç‡∏≤‡∏î</th></tr></thead><tbody id="summary-body"><tr><td colspan='6' style='text-align:center;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody></table>
        </div>
    </div>

    <div id="admin-page" class="page">
        <h2 style="color: #1e56a0;">‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h2>
        <div class="card">
            <h3>üìÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
            <div style="display:flex; gap:10px;"><div style="flex:1"><label>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="date" id="admin-start"></div><div style="flex:1"><label>‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label><input type="date" id="admin-end"></div></div>
        </div>
        <div class="card">
            <h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
            <div style="overflow-x: auto;"><table id="admin-users-table"><thead><tr><th>User</th><th>Pass</th><th>Role</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="admin-users-body"></tbody></table></div>
            <button onclick="addUserRow()" style="margin-top:10px; background:#28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
        </div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap: wrap;">
                <h3 style="margin:0;">üéì ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <select id="admin-class-filter" onchange="renderAdminStudents()" style="width:150px; margin:0; padding:8px;"><option value="all">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option></select>
            </div>
            <div style="overflow-x: auto; max-height: 400px; margin-top:15px; border-top: 1px solid #eee;">
                <table id="admin-students-table"><thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead><tbody id="admin-students-body"></tbody></table>
            </div>
            <button onclick="addStudentRow()" style="margin-top:15px; background:#28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
        </div>
        <button onclick="saveAdminData()" style="width:100%; padding:15px; font-size:18px; margin-bottom: 20px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div id="exec-page" class="page">
        <h2 style="color: #1e56a0; margin-bottom:5px;">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Executive)</h2>
        <p style="color:#666; font-size:14px; margin-top:0;">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö AI ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•</p>
        
        <div class="exec-filters">
            <div>
                <label>üìå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á</label>
                <select id="exec-view-type" onchange="updateExecViewDropdown()">
                    <option value="school">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                    <option value="grade">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>
                    <option value="class">‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</option>
                    <option value="student">‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)</option>
                </select>
            </div>
            <div id="exec-sub-filter-container" style="display:none;">
                <label>üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</label>
                <select id="exec-sub-filter" onchange="processExecData()"></select>
                <input type="text" id="exec-sub-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô..." style="display:none;" onkeyup="if(event.keyCode===13) processExecData()">
            </div>
            <div>
                <label>üìÖ ‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
                <div style="display:flex; gap:5px;">
                    <input type="date" id="exec-date-start" onchange="processExecData()" style="padding:8px; font-size:12px;">
                    <input type="date" id="exec-date-end" onchange="processExecData()" style="padding:8px; font-size:12px;">
                </div>
            </div>
        </div>

        <div class="ai-box">
            <h3>ü§ñ AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏ä‡∏¥‡∏á‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
            <p id="exec-ai-text" style="color:#333; line-height:1.6; margin-bottom:0; font-size:14px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
        </div>

        <div class="stat-grid">
            <div class="stat-card stat-blue"><h3>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡∏Ñ‡∏ô/‡∏ß‡∏±‡∏ô)</h3><h2 id="exec-total">0</h2></div>
            <div class="stat-card stat-green"><h3>‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏∞‡∏™‡∏°</h3><h2 id="exec-present">0</h2></div>
            <div class="stat-card stat-red"><h3>‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤/‡∏õ‡πà‡∏ß‡∏¢‡∏™‡∏∞‡∏™‡∏°</h3><h2 id="exec-absent">0</h2></div>
        </div>

        <div class="card" style="position: relative; height: 350px;">
            <h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
            <canvas id="execChart"></canvas>
        </div>

        <div class="card">
            <h3 id="exec-table-title">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
            <div style="overflow-x: auto; max-height: 400px;">
                <table>
                    <thead id="exec-detail-head"><tr><th>‡∏Å‡∏•‡∏∏‡πà‡∏°</th><th style="color:green;">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th style="color:red;">‡∏Ç‡∏≤‡∏î</th><th style="color:orange;">‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤</th><th>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô</th></tr></thead>
                    <tbody id="exec-detail-body"><tr><td colspan='5' style='text-align:center;'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</td></tr></tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<div class="nav-menu" id="bottom-nav">
    <div class="nav-item active" onclick="switchPage('checklist-page', this)"><span>üìù</span><br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</div>
    <div class="nav-item" onclick="switchPage('daily-page', this)"><span>üìÖ</span><br>‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
    <div class="nav-item" onclick="switchPage('summary-page', this)"><span>üìä</span><br>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>
</div>

<script>
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby5v9D0fYSqrePeJM8G0zPOE6o96FMbdt5E0SdzTJfExgDWpmZvjaXHjdfZ1eWrLNNe/exec"; // ‚ö†Ô∏è ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    document.getElementById('check-date').valueAsDate = new Date();
    document.getElementById('view-date').valueAsDate = new Date();
    
    let d = new Date();
    document.getElementById('exec-date-end').valueAsDate = d;
    d.setDate(d.getDate() - 30); // ‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 30 ‡∏ß‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£
    document.getElementById('exec-date-start').valueAsDate = d;

    let students = [], attendanceData = {}, currentTeacher = "", currentClass = "";
    let allAdminStudentsData = []; 

    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Executive
    let execFullAttendance = [];
    let execFullStudents = [];
    let execChartInstance = null;

    document.getElementById('check-date').addEventListener('change', fetchStudents);

    // --- üîê 1. ‡∏£‡∏∞‡∏ö‡∏ö Login ---
    function handleLogin() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        const btn = document.getElementById('login-btn');
        if (!u || !p) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"); return; }

        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö..."; btn.disabled = true;

        fetch(`${GAS_API_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`)
            .then(res => res.json())
            .then(data => {
                btn.innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"; btn.disabled = false;
                if (data.status === "success") {
                    document.getElementById('user-display').innerText = `${data.name} - ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö`;
                    if (data.role === "admin") {
                        document.getElementById('bottom-nav').style.display = 'none'; 
                        switchPage('admin-page', null); loadAdminData();
                    } else if (data.role === "executive" || data.role === "boss") {
                        document.getElementById('bottom-nav').style.display = 'none'; 
                        switchPage('exec-page', null); fetchFullExecData(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö
                    } else if (data.role === "teacher") {
                        currentTeacher = data.name; currentClass = data.className || ""; 
                        document.getElementById('class-title').innerText = `(${currentClass})`;
                        document.getElementById('bottom-nav').style.display = 'flex'; 
                        switchPage('checklist-page', document.querySelectorAll('.nav-item')[0]); fetchStudents(); 
                    } else if (data.role === "student") {
                        document.getElementById('bottom-nav').style.display = 'none'; 
                        switchPage('student-page', null);
                        document.getElementById('st-name-display').innerText = data.name;
                        document.getElementById('st-id-display').innerText = `‡∏£‡∏´‡∏±‡∏™: ${u} | ‡∏ä‡∏±‡πâ‡∏ô: ${data.className}`;
                        loadStudentReport(u); 
                    }
                } else { alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
            }).catch(err => { btn.innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"; btn.disabled = false; alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"); });
    }

    function logout() { location.reload(); }
    function switchPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        if(element) { document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active')); element.classList.add('active'); }
        document.getElementById(pageId).classList.add('active');
    }

    // ==========================================
    // üíº ‡πÇ‡∏´‡∏°‡∏î EXECUTIVE (‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå AI + ‡∏Å‡∏£‡∏≤‡∏ü Chart.js)
    // ==========================================
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡∏≠‡∏ô Login ‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÄ‡∏ô‡πá‡∏ï
    function fetchFullExecData() {
        document.getElementById('exec-ai-text').innerHTML = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô...";
        fetch(`${GAS_API_URL}?action=get_full_exec_data`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    execFullAttendance = data.attendance;
                    execFullStudents = data.students;
                    updateExecViewDropdown(); // ‡∏™‡∏±‡πà‡∏á‡∏£‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                }
            });
    }

    // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏ô‡∏π‡∏Å‡∏£‡∏≠‡∏á‡∏¢‡πà‡∏≠‡∏¢
    function updateExecViewDropdown() {
        let viewType = document.getElementById('exec-view-type').value;
        let container = document.getElementById('exec-sub-filter-container');
        let sel = document.getElementById('exec-sub-filter');
        let inp = document.getElementById('exec-sub-input');
        
        sel.style.display = 'none'; inp.style.display = 'none';
        
        if(viewType === 'school') {
            container.style.display = 'none';
        } else if(viewType === 'grade') {
            container.style.display = 'block'; sel.style.display = 'block';
            let grades = new Set();
            execFullStudents.forEach(s => { if(s[3]) grades.add(s[3].split('/')[0]); }); // ‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà‡∏°.1, ‡∏°.2
            sel.innerHTML = `<option value="all">‡∏ó‡∏∏‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô</option>`;
            [...grades].sort().forEach(g => sel.innerHTML += `<option value="${g}">${g}</option>`);
        } else if(viewType === 'class') {
            container.style.display = 'block'; sel.style.display = 'block';
            let classes = new Set();
            execFullStudents.forEach(s => { if(s[3]) classes.add(s[3]); });
            sel.innerHTML = `<option value="all">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>`;
            [...classes].sort().forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
        } else if(viewType === 'student') {
            container.style.display = 'block'; inp.style.display = 'block';
            inp.value = "";
        }
        processExecData(); // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢ DD/MM/YYYY ‡πÄ‡∏õ‡πá‡∏ô Date object ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
    function parseThaiDate(dtStr) {
        if(!dtStr) return new Date(0);
        let p = String(dtStr).trim().split('/');
        return new Date(`${p[2]}-${p[1]}-${p[0]}`);
    }

    // 3. ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü
    function processExecData() {
        let viewType = document.getElementById('exec-view-type').value;
        let subFilter = viewType === 'student' ? document.getElementById('exec-sub-input').value.trim() : document.getElementById('exec-sub-filter').value;
        
        let startD = document.getElementById('exec-date-start').valueAsDate || new Date(0);
        let endD = document.getElementById('exec-date-end').valueAsDate || new Date();
        startD.setHours(0,0,0,0); endD.setHours(23,59,59,999);

        let filteredAtt = [];
        let stats = { present:0, absent:0, sick:0, leave:0, totalRecords:0 };
        let groupStats = {}; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏° ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞ ‡∏ä‡∏ô‡∏¥‡∏î
        execFullAttendance.forEach(row => {
            let rowDate = parseThaiDate(row[0]);
            if(rowDate >= startD && rowDate <= endD) {
                let id = String(row[1]).trim();
                let cName = String(row[3]).trim();
                let grade = cName.split('/')[0];
                let stat = String(row[4]).trim();
                
                let match = false;
                let groupKey = "";

                if(viewType === 'school') { match = true; groupKey = cName; } // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≤‡∏ü‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏î‡∏π
                else if(viewType === 'grade') { 
                    if(subFilter === 'all' || grade === subFilter) { match = true; groupKey = cName; }
                }
                else if(viewType === 'class') {
                    if(subFilter === 'all' || cName === subFilter) { match = true; groupKey = row[2]; } // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô
                }
                else if(viewType === 'student') {
                    if(id === subFilter) { match = true; groupKey = row[0]; } // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                }

                if(match) {
                    filteredAtt.push(row);
                    stats.totalRecords++;
                    if(!groupStats[groupKey]) groupStats[groupKey] = {present:0, absent:0, leave:0};
                    
                    if(stat === "‡∏°‡∏≤" || stat === "‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô") { stats.present++; groupStats[groupKey].present++; }
                    else if(stat === "‡∏Ç‡∏≤‡∏î") { stats.absent++; groupStats[groupKey].absent++; }
                    else if(stat === "‡∏õ‡πà‡∏ß‡∏¢") { stats.sick++; groupStats[groupKey].leave++; }
                    else if(stat === "‡∏•‡∏≤") { stats.leave++; groupStats[groupKey].leave++; }
                }
            }
        });

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
        document.getElementById('exec-total').innerText = stats.totalRecords;
        document.getElementById('exec-present').innerText = stats.present;
        document.getElementById('exec-absent').innerText = stats.absent + stats.sick + stats.leave;

        // ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü Chart.js
        drawExecChart(viewType, groupStats, stats);
        
        // ‡∏ß‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        drawExecTable(viewType, groupStats);

        // ü§ñ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ AI 
        generateAIRecommendation(viewType, stats, groupStats);
    }

    function drawExecChart(viewType, groupStats, totalStats) {
        let ctx = document.getElementById('execChart').getContext('2d');
        if(execChartInstance) execChartInstance.destroy();

        if(viewType === 'school' && Object.keys(groupStats).length > 5) {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô Pie
            execChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', '‡∏Ç‡∏≤‡∏î', '‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤'],
                    datasets: [{
                        data: [totalStats.present, totalStats.absent, totalStats.sick + totalStats.leave],
                        backgroundColor: ['#28a745', '#dc3545', '#ffc107']
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        } else {
            // ‡∏ö‡∏≤‡∏£‡πå‡∏ä‡∏≤‡∏£‡πå‡∏ï‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            let labels = Object.keys(groupStats).sort();
            let dPres = labels.map(k => groupStats[k].present);
            let dAbs = labels.map(k => groupStats[k].absent);
            let dLev = labels.map(k => groupStats[k].leave);

            execChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: '‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', data: dPres, backgroundColor: '#28a745' },
                        { label: '‡∏Ç‡∏≤‡∏î', data: dAbs, backgroundColor: '#dc3545' },
                        { label: '‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤', data: dLev, backgroundColor: '#ffc107' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } } }
            });
        }
    }

    function drawExecTable(viewType, groupStats) {
        let head = document.getElementById('exec-detail-head');
        let body = document.getElementById('exec-detail-body');
        
        let firstCol = viewType === 'class' ? "‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" : viewType === 'student' ? "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" : "‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô";
        head.innerHTML = `<tr><th>${firstCol}</th><th style="color:green;">‡∏°‡∏≤</th><th style="color:red;">‡∏Ç‡∏≤‡∏î</th><th style="color:orange;">‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤</th><th>% ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th></tr>`;
        
        body.innerHTML = "";
        let keys = Object.keys(groupStats).sort();
        if(keys.length === 0) { body.innerHTML = `<tr><td colspan='5' style='text-align:center;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`; return; }

        keys.forEach(k => {
            let g = groupStats[k];
            let tot = g.present + g.absent + g.leave;
            let perc = tot > 0 ? ((g.present/tot)*100).toFixed(1) : 0;
            let pColor = perc >= 80 ? 'green' : perc >= 60 ? 'orange' : 'red';
            
            body.innerHTML += `<tr>
                <td><b>${k}</b></td>
                <td>${g.present}</td><td>${g.absent}</td><td>${g.leave}</td>
                <td><b style="color:${pColor};">${perc}%</b></td>
            </tr>`;
        });
    }

    function generateAIRecommendation(viewType, stats, groupStats) {
        let aiBox = document.getElementById('exec-ai-text');
        if(stats.totalRecords === 0) { aiBox.innerHTML = "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"; return; }

        let presentRate = ((stats.present / stats.totalRecords) * 100).toFixed(1);
        let text = `<b>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°:</b> ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà <b style="font-size:16px; color:${presentRate>=80?'green':'red'};">${presentRate}%</b><br><br>`;

        if(viewType === 'school' || viewType === 'grade') {
            // ‡∏´‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î
            let worstClass = "", lowestRate = 100;
            for(let k in groupStats) {
                let r = (groupStats[k].present / (groupStats[k].present+groupStats[k].absent+groupStats[k].leave))*100;
                if(r < lowestRate) { lowestRate = r; worstClass = k; }
            }
            if(presentRate >= 85) text += `üåü <b>‡∏Ñ‡∏≥‡∏ä‡∏∑‡πà‡∏ô‡∏ä‡∏°:</b> ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û<br>üí° <b>‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞:</b> ‡∏≠‡∏≤‡∏à‡∏û‡∏ö‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡πÄ‡∏ä‡πà‡∏ô <b>${worstClass} (${lowestRate.toFixed(1)}%)</b> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏£‡∏π‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`;
            else text += `‚ö†Ô∏è <b>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á:</b> ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå 85% ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ <b>${worstClass} (‡∏°‡∏≤‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${lowestRate.toFixed(1)}%)</b><br>üí° <b>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</b> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏õ‡∏±‡∏ç‡∏´‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`;
        } 
        else if (viewType === 'class') {
            text += `üí° <b>‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏´‡πâ‡∏≠‡∏á:</b> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏≠‡∏≠‡∏Å‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ö‡πâ‡∏≤‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏∏‡∏î‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö`;
        }
        else { text += `üí° <b>‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•:</b> ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏™‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`; }

        aiBox.innerHTML = text;
    }

    // ==========================================
    // üéì ‡πÇ‡∏´‡∏°‡∏î STUDENT (‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°) 
    // ==========================================
    function loadStudentReport(studentId) {
        let tbody = document.getElementById('student-history-body');
        tbody.innerHTML = `<tr><td colspan='3' style='text-align:center;'>‚è≥ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;
        fetch(`${GAS_API_URL}?action=get_student_report&studentId=${encodeURIComponent(studentId)}`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    let st = data.stats;
                    document.getElementById('st-stat-present').innerText = st.present;
                    document.getElementById('st-stat-absent').innerText = st.absent;
                    document.getElementById('st-stat-leave').innerText = st.sick + st.leave;
                    let aiText = "";
                    if(st.total === 0) aiText = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏∏‡πà‡∏á‡∏°‡∏±‡πà‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö! ‚úåÔ∏è";
                    else {
                        let presentPercent = (st.present / st.total) * 100;
                        if(presentPercent >= 90) aiText = `üåü ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß‡∏™‡∏π‡∏á‡∏ñ‡∏∂‡∏á <b>${presentPercent.toFixed(1)}%</b> ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏µ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!`;
                        else if(presentPercent >= 70) aiText = `üëç ‡∏ô‡πà‡∏≤‡∏û‡∏≠‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡∏ö (<b>${presentPercent.toFixed(1)}%</b>) ‡∏•‡∏≠‡∏á‡∏•‡∏î‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏î‡∏•‡∏á‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡∏ô‡∏∞!`;
                        else aiText = `‚ö†Ô∏è <b>‡∏£‡∏∞‡∏ß‡∏±‡∏á:</b> ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ô‡πâ‡∏≠‡∏¢ (<b>${presentPercent.toFixed(1)}%</b>) ‡∏≠‡∏≤‡∏à‡∏´‡∏°‡∏î‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô‡∏î‡πà‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö`;
                    }
                    document.getElementById('ai-assessment-text').innerHTML = aiText;
                    tbody.innerHTML = "";
                    if(data.history.length === 0) tbody.innerHTML = `<tr><td colspan='3' style='text-align:center;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td></tr>`;
                    else {
                        data.history.reverse().forEach(h => {
                            let color = (h.status === '‡∏°‡∏≤' || h.status === '‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô') ? 'green' : h.status === '‡∏õ‡πà‡∏ß‡∏¢' ? 'red' : h.status === '‡∏•‡∏≤' ? '#ffc107' : 'orange';
                            tbody.innerHTML += `<tr><td>${h.date}</td><td><b style="color:${color}">${h.status}</b></td><td style="color:#666; font-size:12px;">${h.note || '-'}</td></tr>`;
                        });
                    }
                }
            });
    }

    // ==========================================
    // ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏£‡∏π ‡πÅ‡∏•‡∏∞ ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô (‡∏¢‡πà‡∏≠‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÑ‡∏°‡πà‡∏¢‡∏≤‡∏ß‡πÄ‡∏Å‡∏¥‡∏ô ‡πÅ‡∏ï‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
    // ==========================================
    function fetchStudents() { /* ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏£‡∏π‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° */ }
    function renderChecklist(ext, rec) { /* ‡πÇ‡∏Ñ‡πâ‡∏î‡∏Ñ‡∏£‡∏π‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° */ }
    function loadAdminData() { /* ‡πÇ‡∏Ñ‡πâ‡∏î‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏î‡∏¥‡∏° */ }
    // ... [‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ú‡∏°‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Admin ‡πÅ‡∏•‡∏∞ Teacher ‡∏ï‡∏±‡∏ß‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡πÅ‡∏ï‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡∏´‡∏≤‡∏Å‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ‡πÑ‡∏õ‡∏ß‡∏≤‡∏á‡∏°‡∏±‡∏ô‡∏à‡∏∞‡∏£‡∏±‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ 100% ‡∏Ñ‡∏£‡∏±‡∏ö] ...

</script>
</body>
</html>
