<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS BCW - ‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e56a0; --bg: #f3f5f9; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; padding: 0; padding-bottom: 80px; }
        .navbar { background: var(--primary); color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
        .container { max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        .card { background: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* ‡πÄ‡∏°‡∏ô‡∏π / ‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ */
        .nav-menu { position: fixed; bottom: 0; width: 100%; background: white; display: none; justify-content: space-around; padding: 10px 0; border-top: 1px solid #ddd; z-index: 1000;}
        .nav-item { text-align: center; font-size: 13px; color: #64748b; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }
        
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Prompt'; width: 100%; box-sizing: border-box; margin-bottom: 10px;}
        button { padding: 10px 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-family: 'Prompt'; font-weight: bold;}
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á/‡πÅ‡∏ñ‡∏ß‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠ (‡∏Ñ‡∏£‡∏π) */
        .toolbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px;}
        .date-picker { padding: 8px; border: 1px solid #ccc; border-radius: 8px; font-family: 'Prompt'; font-size: 16px; margin-bottom:0; width:auto;}
        .student-row { display: flex; flex-direction: column; background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; margin-bottom: 15px; transition: 0.3s; }
        .student-info { display: flex; align-items: center; margin-bottom: 10px; }
        .student-number { font-size: 18px; font-weight: bold; color: #64748b; width: 40px; text-align: center; }
        .img-container { position: relative; width: 60px; height: 60px; margin-right: 15px; }
        .student-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 2px solid #ddd; }
        .upload-btn { position: absolute; bottom: -5px; right: -5px; background: var(--primary); color: white; border: none; border-radius: 50%; width: 25px; height: 25px; font-size: 12px; cursor: pointer; display: flex; justify-content: center; align-items: center;}
        .student-name { flex-grow: 1; font-size: 16px; font-weight: 600; color: #15283c; }
        .status-group { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;}
        .btn-status { flex: 1; padding: 8px 5px; border: 1px solid #ddd; border-radius: 6px; background: white; cursor: pointer; font-family: 'Prompt'; font-size: 14px; transition: 0.2s; text-align: center; font-weight: bold; color: #666;}
        .behavior-note { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-family: 'Prompt'; font-size: 13px; box-sizing: border-box; resize: vertical; min-height: 40px;}
        .status-present.active { background-color: #28a745; color: white; border-color: #28a745; }
        .status-sick.active { background-color: #dc3545; color: white; border-color: #dc3545; }
        .status-leave.active { background-color: #ffc107; color: #000; border-color: #ffc107; }
        .status-absent.active { background-color: #fd7e14; color: white; border-color: #fd7e14; }
        .row-present { background-color: #e8f5e9; border-left: 6px solid #28a745; }
        .row-sick { background-color: #ffebee; border-left: 6px solid #dc3545; }
        .row-leave { background-color: #fff8e1; border-left: 6px solid #ffc107; }
        .row-absent { background-color: #fff3e0; border-left: 6px solid #fd7e14; }
        .save-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Prompt'; margin-top: 10px;}

        /* ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏≠‡∏∑‡πà‡∏ô‡πÜ */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 14px; background: white;}
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
        th { background: #f8f9fa; }
        
        /* Exec Dashboard Stats */
        .stat-grid { display: flex; gap: 10px; margin-bottom: 20px; }
        .stat-card { flex: 1; padding: 20px; border-radius: 10px; color: white; text-align: center; }
        .stat-blue { background: linear-gradient(135deg, #1e56a0, #2a6fcc); }
        .stat-green { background: linear-gradient(135deg, #28a745, #34ce57); }
        .stat-red { background: linear-gradient(135deg, #dc3545, #e4606d); }
        .stat-card h3 { margin: 0; font-size: 14px; opacity: 0.9; }
        .stat-card h2 { margin: 5px 0 0 0; font-size: 28px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: bold;">üè´ SIS ‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤</div>
    <div id="user-display" style="font-size: 12px; cursor: pointer;" onclick="logout()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
</div>

<div class="container">
    
    <div id="login-page" class="page active">
        <div class="card" style="text-align: center; max-width: 400px; margin: 40px auto;">
            <h2 style="color: #1e56a0;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <input type="text" id="username" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô">
            <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button id="login-btn" onclick="handleLogin()" style="width: 100%; font-size:16px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>

    <div id="checklist-page" class="page">
        <div class="toolbar">
            <h2 style="margin: 0;">üìù ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß <span id="class-title" style="color:var(--primary);"></span></h2>
            <input type="date" id="check-date" class="date-picker">
        </div>
        <div id="student-list-container"></div>
        <button class="save-btn" id="save-btn" onclick="saveAttendance()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>

    <div id="daily-page" class="page">
        <div class="card">
            <h2>üìÖ ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h2>
            <p style="color: #666; font-size: 13px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>
            <input type="date" id="view-date" class="date-picker" style="margin-bottom: 15px; width:100%;">
            <button onclick="loadDailyData()" style="width:100%; background: var(--primary);">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <table id="daily-table">
                <thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr></thead>
                <tbody id="daily-body"><tr><td colspan='4' style='text-align:center;'>‡∏Å‡∏î‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td></tr></tbody>
            </table>
        </div>
    </div>

    <div id="summary-page" class="page">
        <div class="card">
            <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
            <p style="color: #666; font-size: 13px;">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ß‡πà‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô ‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤/‡∏õ‡πà‡∏ß‡∏¢ ‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô</p>
            <button onclick="loadSummaryData()" style="width:100%; background: #28a745; margin-bottom: 15px;">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
            <table id="summary-table">
                <thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th style="color:#28a745;">‡∏°‡∏≤</th><th style="color:#dc3545;">‡∏õ‡πà‡∏ß‡∏¢</th><th style="color:#ffc107;">‡∏•‡∏≤</th><th style="color:#fd7e14;">‡∏Ç‡∏≤‡∏î</th></tr></thead>
                <tbody id="summary-body"><tr><td colspan='6' style='text-align:center;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr></tbody>
            </table>
        </div>
    </div>

    <div id="admin-page" class="page">
        <h2 style="color: #1e56a0;">‚öôÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (Admin)</h2>
        <div class="card">
            <h3>üìÖ ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
            <div style="display:flex; gap:10px;">
                <div style="flex:1"><label>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label><input type="date" id="admin-start"></div>
                <div style="flex:1"><label>‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label><input type="date" id="admin-end"></div>
            </div>
        </div>
        <div class="card">
            <h3>üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡∏Ñ‡∏£‡∏π/Admin)</h3>
            <p style="font-size:12px; color:#666;">* ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
            <div style="overflow-x: auto;">
                <table id="admin-users-table">
                    <thead><tr><th>Username</th><th>Password</th><th>Role</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="admin-users-body"></tbody>
                </table>
            </div>
            <button onclick="addUserRow()" style="margin-top:10px; background:#28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
        </div>
        <div class="card">
            <h3>üéì ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <div style="overflow-x: auto;">
                <table id="admin-students-table">
                    <thead><tr><th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th><th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody id="admin-students-body"></tbody>
                </table>
            </div>
            <button onclick="addStudentRow()" style="margin-top:10px; background:#28a745;">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</button>
        </div>
        <button onclick="saveAdminData()" style="width:100%; padding:15px; font-size:18px; margin-bottom: 20px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>

    <div id="exec-page" class="page">
        <h2 style="color: #1e56a0;">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ (Executive)</h2>
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <b>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</b>
            <input type="date" id="exec-date" class="date-picker" style="width: auto; margin:0;" onchange="loadExecReport()">
        </div>
        <div class="stat-grid">
            <div class="stat-card stat-blue"><h3>‡∏ô‡∏£. ‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3><h2 id="exec-total">0</h2></div>
            <div class="stat-card stat-green"><h3>‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3><h2 id="exec-present">0</h2></div>
            <div class="stat-card stat-red"><h3>‡∏Ç‡∏≤‡∏î/‡∏•‡∏≤/‡∏õ‡πà‡∏ß‡∏¢</h3><h2 id="exec-absent">0</h2></div>
        </div>
        <div class="card">
            <h3>üìà ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á (‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô)</h3>
            <table>
                <thead><tr><th>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th style="color:green;">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th style="color:red;">‡∏Ç‡∏≤‡∏î</th><th style="color:orange;">‡∏õ‡πà‡∏ß‡∏¢/‡∏•‡∏≤</th></tr></thead>
                <tbody id="exec-class-body"><tr><td colspan='4' style='text-align:center;'>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr></tbody>
            </table>
        </div>
    </div>

</div>

<div class="nav-menu" id="bottom-nav">
    <div class="nav-item active" onclick="switchPage('checklist-page', this)"><span>üìù</span><br>‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</div>
    <div class="nav-item" onclick="switchPage('daily-page', this)"><span>üìÖ</span><br>‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
    <div class="nav-item" onclick="switchPage('summary-page', this)"><span>üìä</span><br>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•</div>
</div>

<script>
    // üîó API ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycbxDBIimksCjbqS--gvganUMDGNLVE3B55IYmDMOz7vK9zq4K8h9kxdgZzEsa9AVM6Jy/exec";
    
    document.getElementById('check-date').valueAsDate = new Date();
    document.getElementById('view-date').valueAsDate = new Date();
    document.getElementById('exec-date').valueAsDate = new Date();

    let students = []; 
    let attendanceData = {}; 
    let currentTeacher = "";
    let currentClass = "";

    document.getElementById('check-date').addEventListener('change', fetchStudents);

    // --- üîê 1. ‡∏£‡∏∞‡∏ö‡∏ö Login (‡πÅ‡∏¢‡∏Å Role) ---
    function handleLogin() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        const btn = document.getElementById('login-btn');
        if (!u || !p) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"); return; }

        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...";
        btn.disabled = true;

        fetch(`${GAS_API_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`)
            .then(res => res.json())
            .then(data => {
                btn.innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
                btn.disabled = false;
                if (data.status === "success") {
                    document.getElementById('user-display').innerText = `${data.name} - ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö`;
                    
                    if (data.role === "admin") {
                        document.getElementById('bottom-nav').style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ñ‡∏£‡∏π
                        switchPage('admin-page', null);
                        loadAdminData();
                    } else if (data.role === "executive" || data.role === "boss") {
                        document.getElementById('bottom-nav').style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏Ñ‡∏£‡∏π
                        switchPage('exec-page', null);
                        loadExecReport();
                    } else if (data.role === "teacher") {
                        currentTeacher = data.name;
                        currentClass = data.className || ""; 
                        document.getElementById('class-title').innerText = `(${currentClass})`;
                        document.getElementById('bottom-nav').style.display = 'flex'; // ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏ô‡∏π‡∏Ñ‡∏£‡∏π
                        switchPage('checklist-page', document.querySelectorAll('.nav-item')[0]);
                        fetchStudents(); 
                    }
                } else { alert("‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"); }
            }).catch(err => { btn.innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö"; btn.disabled = false; alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ"); });
    }

    function logout() { location.reload(); }

    function switchPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        if(element) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
        }
        document.getElementById(pageId).classList.add('active');
    }

    // ==========================================
    // üë©‚Äçüè´ ‡πÇ‡∏´‡∏°‡∏î TEACHER (‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô)
    // ==========================================
    function fetchStudents() {
        const container = document.getElementById('student-list-container');
        container.innerHTML = `<div style="text-align:center; padding: 30px; color:#1e56a0; font-weight:bold;">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>`;
        document.getElementById('save-btn').style.display = 'none';
        let dateRaw = document.getElementById('check-date').value;

        fetch(`${GAS_API_URL}?action=get_students&className=${encodeURIComponent(currentClass)}`)
            .then(res => res.json())
            .then(dataStd => {
                if(dataStd.status === "success" && dataStd.data.length > 0) {
                    students = dataStd.data; 
                    fetch(`${GAS_API_URL}?action=check_existing&className=${encodeURIComponent(currentClass)}&date=${dateRaw}`)
                        .then(res => res.json())
                        .then(dataCheck => {
                            if(dataCheck.status === "found") renderChecklist(dataCheck.data, dataCheck.recordedBy);
                            else renderChecklist(null, null); 
                        });
                } else {
                    container.innerHTML = `<div style="text-align:center; padding: 20px; color:red;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏´‡πâ‡∏≠‡∏á ${currentClass}</div>`;
                }
            });
    }

    function renderChecklist(existingData, recordedBy) {
        const container = document.getElementById('student-list-container');
        container.innerHTML = "";
        if(existingData) {
            container.innerHTML = `<div style="background:#fff3cd; color:#856404; padding:15px; border-radius:8px; margin-bottom:15px; font-weight:bold;">‚ö†Ô∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${document.getElementById('check-date').value} <br>‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏î‡∏¢: ${recordedBy}</div>`;
            document.getElementById('save-btn').style.display = 'none'; 
        } else {
            document.getElementById('save-btn').style.display = 'block'; 
        }

        students.forEach(std => {
            let initStatus = 'present', initNote = '';
            if(existingData && existingData[std.id]) {
                let thStat = existingData[std.id].status;
                initStatus = thStat === "‡∏õ‡πà‡∏ß‡∏¢" ? "sick" : thStat === "‡∏•‡∏≤" ? "leave" : thStat === "‡∏Ç‡∏≤‡∏î" ? "absent" : "present";
                initNote = existingData[std.id].note;
            }
            attendanceData[std.id] = { status: initStatus, note: initNote };
            let defaultImg = `https://ui-avatars.com/api/?name=${std.name}&background=f3f5f9`;
            let row = document.createElement('div');
            row.className = `student-row row-${initStatus}`; row.id = `row-${std.id}`;

            let displayModeHtml = "";
            if (existingData) {
                let colorStat = initStatus==='present' ? 'green' : initStatus==='sick' ? 'red' : initStatus==='leave' ? '#ffc107' : 'orange';
                let thText = initStatus==='present' ? '‚úÖ ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô' : initStatus==='sick' ? 'ü§í ‡∏õ‡πà‡∏ß‡∏¢' : initStatus==='leave' ? 'üìù ‡∏•‡∏≤' : '‚ùå ‡∏Ç‡∏≤‡∏î';
                displayModeHtml = `<div id="display-mode-${std.id}" style="display:flex; justify-content:space-between; align-items:center; width:100%; margin-top:5px; background:#f8f9fa; padding:10px; border-radius:8px; box-sizing:border-box;">
                    <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b style="color:${colorStat}">${thText}</b></div>
                    <button onclick="enableEdit('${std.id}')" style="padding:5px 15px; background:#17a2b8;">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>`;
            }
            let btnStyle = existingData ? "display:none;" : "display:flex;";
            row.innerHTML = `
                <div class="student-info">
                    <div class="student-number">${std.number}</div>
                    <div class="img-container"><img src="${defaultImg}" id="img-${std.id}" class="student-img"></div>
                    <div class="student-name">${std.name}<br><small style="color:#666;">‡∏£‡∏´‡∏±‡∏™: ${std.id}</small></div>
                </div>
                ${displayModeHtml}
                <div id="edit-mode-${std.id}" style="${btnStyle} flex-direction:column;">
                    <div class="status-group">
                        <div class="btn-status status-present ${initStatus==='present'?'active':''}" onclick="setStatus('${std.id}', 'present')">‚úÖ ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</div>
                        <div class="btn-status status-sick ${initStatus==='sick'?'active':''}" onclick="setStatus('${std.id}', 'sick')">ü§í ‡∏õ‡πà‡∏ß‡∏¢</div>
                        <div class="btn-status status-leave ${initStatus==='leave'?'active':''}" onclick="setStatus('${std.id}', 'leave')">üìù ‡∏•‡∏≤</div>
                        <div class="btn-status status-absent ${initStatus==='absent'?'active':''}" onclick="setStatus('${std.id}', 'absent')">‚ùå ‡∏Ç‡∏≤‡∏î</div>
                    </div>
                    <textarea class="behavior-note" id="note-${std.id}" placeholder="‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°/‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏... (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">${initNote}</textarea>
                    ${existingData ? `<div style="display:flex; gap:10px; margin-top:10px;">
                        <button onclick="saveSingleUpdate('${std.id}')" style="flex:1; background:#28a745;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                        <button onclick="cancelEdit('${std.id}')" style="background:#6c757d;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    </div>` : ''}
                </div>`;
            container.appendChild(row);
        });
    }

    function enableEdit(id) { document.getElementById(`display-mode-${id}`).style.display = 'none'; document.getElementById(`edit-mode-${id}`).style.display = 'flex'; }
    function cancelEdit(id) { document.getElementById(`display-mode-${id}`).style.display = 'flex'; document.getElementById(`edit-mode-${id}`).style.display = 'none'; }
    function setStatus(id, status) {
        attendanceData[id].status = status;
        let row = document.getElementById(`row-${id}`);
        row.className = `student-row row-${status}`;
        row.querySelectorAll('.btn-status').forEach(btn => btn.classList.remove('active'));
        row.querySelector(`.status-${status}`).classList.add('active');
    }

    function saveAttendance() {
        let date = document.getElementById('check-date').value;
        let saveBtn = document.getElementById('save-btn');
        let records = [];
        students.forEach(std => {
            records.push({ id: std.id, name: std.name, className: std.className || currentClass, status: attendanceData[std.id].status, note: document.getElementById(`note-${std.id}`).value });
        });
        saveBtn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•..."; saveBtn.disabled = true;
        fetch(GAS_API_URL, { method: "POST", body: JSON.stringify({ action: "save_bulk", date: date, teacherName: currentTeacher, records: records }) })
        .then(res => res.json())
        .then(data => {
            saveBtn.innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; saveBtn.disabled = false;
            if(data.status === "success") { alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"); fetchStudents(); } 
            else { alert("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + data.message); }
        });
    }

    function saveSingleUpdate(id) {
        fetch(GAS_API_URL, { method: "POST", body: JSON.stringify({ action: "update_single", date: document.getElementById('check-date').value, id: id, className: currentClass, status: attendanceData[id].status, note: document.getElementById(`note-${id}`).value, teacherName: currentTeacher }) })
        .then(res => res.json()).then(data => { if(data.status === "success") { alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!"); fetchStudents(); } });
    }

    function loadDailyData() {
        let viewDate = document.getElementById('view-date').value;
        if (!viewDate) return;
        let tbody = document.getElementById('daily-body');
        tbody.innerHTML = `<tr><td colspan='4' style='text-align:center;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>`;
        fetch(`${GAS_API_URL}?action=get_daily&className=${encodeURIComponent(currentClass)}&date=${viewDate}`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    tbody.innerHTML = "";
                    if(data.data.length === 0) { tbody.innerHTML = `<tr><td colspan='4' style='text-align:center;'>‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</td></tr>`; return; }
                    data.data.forEach((d, index) => {
                        let statusTh = (d.status === '‡∏°‡∏≤' || d.status === '‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô') ? '<span style="color:green; font-weight:bold;">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>' : d.status === '‡∏õ‡πà‡∏ß‡∏¢' ? '<span style="color:red; font-weight:bold;">‡∏õ‡πà‡∏ß‡∏¢</span>' : d.status === '‡∏•‡∏≤' ? '<span style="color:#ffc107; font-weight:bold;">‡∏•‡∏≤</span>' : '<span style="color:orange; font-weight:bold;">‡∏Ç‡∏≤‡∏î</span>';
                        tbody.innerHTML += `<tr><td>${index + 1}</td><td>${d.name}</td><td>${statusTh}</td><td style="color:#666; font-size:12px;">${d.note || '-'}</td></tr>`;
                    });
                }
            });
    }

    function loadSummaryData() {
        let tbody = document.getElementById('summary-body');
        tbody.innerHTML = `<tr><td colspan='6' style='text-align:center;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥...</td></tr>`;
        fetch(`${GAS_API_URL}?action=get_summary&className=${encodeURIComponent(currentClass)}`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    tbody.innerHTML = "";
                    if(data.data.length === 0) { tbody.innerHTML = `<tr><td colspan='6' style='text-align:center;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>`; return; }
                    data.data.forEach((d, index) => {
                        tbody.innerHTML += `<tr><td>${index + 1}</td><td>${d.name}</td><td style="color: #28a745; font-weight:bold;">${d.present}</td><td style="color: #dc3545;">${d.sick}</td><td style="color: #ffc107;">${d.leave}</td><td style="color: #fd7e14;">${d.absent}</td></tr>`;
                    });
                }
            });
    }

    // ==========================================
    // ‚öôÔ∏è ‡πÇ‡∏´‡∏°‡∏î ADMIN (‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)
    // ==========================================
    function loadAdminData() {
        fetch(`${GAS_API_URL}?action=get_admin_data`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    document.getElementById('admin-start').value = data.config.startDate;
                    document.getElementById('admin-end').value = data.config.endDate;
                    let uBody = document.getElementById('admin-users-body');
                    uBody.innerHTML = "";
                    data.users.forEach((u, i) => {
                        uBody.innerHTML += `<tr>
                            <td><input type="text" value="${u[0]}" id="u-user-${i}"></td>
                            <td><input type="text" value="${u[1]}" id="u-pass-${i}"></td>
                            <td><select id="u-role-${i}">
                                <option value="teacher" ${u[2]=='teacher'?'selected':''}>Teacher</option>
                                <option value="admin" ${u[2]=='admin'?'selected':''}>Admin</option>
                                <option value="executive" ${u[2]=='executive'?'selected':''}>Executive</option>
                            </select></td>
                            <td><input type="text" value="${u[3]}" id="u-name-${i}"></td>
                            <td><input type="text" value="${u[4]||''}" id="u-class-${i}"></td>
                            <td><button style="background:red;" onclick="this.parentElement.parentElement.remove()">‡∏•‡∏ö</button></td>
                        </tr>`;
                    });
                    let sBody = document.getElementById('admin-students-body');
                    sBody.innerHTML = "";
                    data.students.forEach((s, i) => {
                        sBody.innerHTML += `<tr>
                            <td><input type="text" value="${s[0]}" id="s-num-${i}" style="width:50px;"></td>
                            <td><input type="text" value="${s[1]}" id="s-id-${i}"></td>
                            <td><input type="text" value="${s[2]}" id="s-name-${i}"></td>
                            <td><input type="text" value="${s[3]}" id="s-class-${i}"></td>
                            <td><button style="background:red;" onclick="this.parentElement.parentElement.remove()">‡∏•‡∏ö</button></td>
                        </tr>`;
                    });
                }
            });
    }

    function addUserRow() {
        let i = Date.now();
        document.getElementById('admin-users-body').innerHTML += `<tr>
            <td><input type="text" id="u-user-${i}"></td>
            <td><input type="text" id="u-pass-${i}"></td>
            <td><select id="u-role-${i}"><option value="teacher">Teacher</option><option value="admin">Admin</option><option value="executive">Executive</option></select></td>
            <td><input type="text" id="u-name-${i}"></td>
            <td><input type="text" id="u-class-${i}"></td>
            <td><button style="background:red;" onclick="this.parentElement.parentElement.remove()">‡∏•‡∏ö</button></td>
        </tr>`;
    }

    function addStudentRow() {
        let i = Date.now();
        document.getElementById('admin-students-body').innerHTML += `<tr>
            <td><input type="text" id="s-num-${i}" style="width:50px;"></td>
            <td><input type="text" id="s-id-${i}"></td>
            <td><input type="text" id="s-name-${i}"></td>
            <td><input type="text" id="s-class-${i}"></td>
            <td><button style="background:red;" onclick="this.parentElement.parentElement.remove()">‡∏•‡∏ö</button></td>
        </tr>`;
    }

    function saveAdminData() {
        let btn = document.querySelector('#admin-page > button');
        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
        let users = [], students = [];
        document.querySelectorAll('#admin-users-body tr').forEach(tr => {
            let inputs = tr.querySelectorAll('input, select');
            users.push([inputs[0].value, inputs[1].value, inputs[2].value, inputs[3].value, inputs[4].value]);
        });
        document.querySelectorAll('#admin-students-body tr').forEach(tr => {
            let inputs = tr.querySelectorAll('input');
            students.push([inputs[0].value, inputs[1].value, inputs[2].value, inputs[3].value]);
        });

        fetch(GAS_API_URL, { method: "POST", body: JSON.stringify({
            action: "admin_update",
            settings: { startDate: document.getElementById('admin-start').value, endDate: document.getElementById('admin-end').value },
            users: users, students: students
        }) })
        .then(res => res.json())
        .then(data => {
            btn.innerText = "üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
            if(data.status === "success") alert("‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
        });
    }

    // ==========================================
    // üìä ‡πÇ‡∏´‡∏°‡∏î EXECUTIVE (‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£)
    // ==========================================
    function loadExecReport() {
        let date = document.getElementById('exec-date').value;
        fetch(`${GAS_API_URL}?action=get_exec_report&date=${date}`)
            .then(res => res.json())
            .then(data => {
                if(data.status === "success") {
                    document.getElementById('exec-total').innerText = data.data.total_students;
                    document.getElementById('exec-present').innerText = data.data.present_today;
                    document.getElementById('exec-absent').innerText = data.data.absent_today;
                    
                    let tbody = document.getElementById('exec-class-body');
                    tbody.innerHTML = "";
                    let classes = data.data.classes;
                    
                    if(Object.keys(classes).length === 0) {
                        tbody.innerHTML = `<tr><td colspan='4' style='text-align:center;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</td></tr>`;
                    } else {
                        for(let cName in classes) {
                            tbody.innerHTML += `<tr>
                                <td><b>${cName}</b></td>
                                <td style="color:green; font-weight:bold;">${classes[cName].present}</td>
                                <td style="color:red;">${classes[cName].absent}</td>
                                <td style="color:orange;">${classes[cName].sick + classes[cName].leave}</td>
                            </tr>`;
                        }
                    }
                }
            });
    }
</script>

</body>
</html>
