<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS BCW - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root { --primary: #1e56a0; --secondary: #15283c; --success: #28a745; --bg: #f3f5f9; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--secondary); pb: 70px; }
        
        /* Navigation Bar */
        .navbar { background: var(--primary); color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .nav-menu { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); border-top: 1px solid #ddd; }
        .nav-item { text-align: center; font-size: 12px; color: #64748b; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }

        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        
        .card { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        #reader { width: 100%; border-radius: 12px; overflow: hidden; border: 2px solid #eef2f5; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
        .result-box { display: none; align-items: center; background: #e8f5e9; padding: 15px; border-radius: 12px; border-left: 6px solid var(--success); margin-top: 20px; }
        .result-box img { width: 60px; height: 60px; border-radius: 50%; margin-right: 15px; border: 2px solid #fff; }
        .status-badge { background: var(--success); color: white; padding: 3px 10px; border-radius: 20px; font-size: 12px; display: inline-block; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loading { text-align: center; color: #f59e0b; display: none; margin: 15px 0; }
        
        /* Table ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: bold;">SIS @ Ban Chiang Wittaya</div>
    <div style="font-size: 12px;">‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä (Admin)</div>
</div>

<div class="container">
    
    <div id="scan-page" class="page active">
        <div class="card">
            <h2 style="text-align: center; margin-top: 0;">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß</h2>
            <div id="reader"></div>
            <div id="loading" class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            
            <div id="result-box" class="result-box">
                <img id="student-img" src="" alt="">
                <div class="result-info">
                    <div id="status-badge" class="status-badge">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                    <h3 id="student-name" style="margin: 5px 0;">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <p style="margin: 0; font-size: 13px;">‡∏£‡∏´‡∏±‡∏™: <b id="student-id">...</b> | ‡∏ä‡∏±‡πâ‡∏ô: <b id="student-class">...</b></p>
                </div>
            </div>
        </div>
    </div>

    <div id="history-page" class="page">
        <div class="card">
            <h2>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
            <p style="color: #666; font-size: 13px;">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p>
            <table id="history-table">
                <thead>
                    <tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á</th></tr>
                </thead>
                <tbody id="history-body">
                    </tbody>
            </table>
        </div>
    </div>

</div>

<div class="nav-menu">
    <div class="nav-item active" onclick="switchPage('scan-page', this)">
        <span>üì∏</span><br>‡∏™‡πÅ‡∏Å‡∏ô
    </div>
    <div class="nav-item" onclick="switchPage('history-page', this)">
        <span>üìÖ</span><br>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    </div>
    <div class="nav-item" onclick="window.location.href='parent.html'">
        <span>üë•</span><br>‡∏ú‡∏π‡πâ‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á
    </div>
</div>

<script>
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby3zyx9w_k1jBHmROtBt9GdfkQtPfuxRLo4H_VZtVoaqFpkvbReVH6upPyV-qGY3kc5/exec";
    let lastScannedId = "";
    let lastScanTime = 0;

    function switchPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        element.classList.add('active');
    }

    function onScanSuccess(decodedText) {
        let now = Date.now();
        if (decodedText === lastScannedId && (now - lastScanTime) < 5000) return;
        
        lastScannedId = decodedText;
        lastScanTime = now;

        document.getElementById('result-box').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        fetch(GAS_API_URL + "?id=" + encodeURIComponent(decodedText))
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                if(data.status === "success" || data.status === "warning") {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
                    document.getElementById('student-name').innerText = data.name;
                    document.getElementById('student-id').innerText = data.id;
                    document.getElementById('student-class').innerText = data.className;
                    document.getElementById('student-img').src = `https://ui-avatars.com/api/?name=${data.name}&background=random&color=fff&rounded=true`;
                    document.getElementById('result-box').style.display = 'flex';
                    
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ (Link ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏°‡∏ô‡∏π)
                    addHistoryRow(data);
                } else {
                    alert(data.message);
                }
            })
            .catch(err => {
                document.getElementById('loading').style.display = 'none';
                alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
            });
    }

    function addHistoryRow(data) {
        const tbody = document.getElementById('history-body');
        const row = tbody.insertRow(0);
        const time = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        row.innerHTML = `<td>${time}</td><td>${data.name}</td><td>${data.className}</td>`;
    }

    let html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
    html5QrcodeScanner.render(onScanSuccess);
</script>

</body>
</html>
