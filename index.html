<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIS BCW - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        :root { --primary: #1e56a0; --secondary: #15283c; --success: #28a745; --bg: #f3f5f9; }
        body { font-family: 'Prompt', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--secondary); padding-bottom: 70px; }
        
        .navbar { background: var(--primary); color: white; padding: 15px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .nav-menu { position: fixed; bottom: 0; width: 100%; background: white; display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏∞ Login */ justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); border-top: 1px solid #ddd; z-index: 1000;}
        .nav-item { text-align: center; font-size: 12px; color: #64748b; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); font-weight: bold; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 2px; }

        .container { max-width: 600px; margin: 20px auto; padding: 0 15px; }
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        
        .card { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤ Login */
        .login-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Prompt'; }
        .login-btn { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-family: 'Prompt'; font-size: 16px;}
        
        /* ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå */
        #reader { width: 100%; border-radius: 12px; overflow: hidden; border: 2px solid #eef2f5; }
        .result-box { display: none; align-items: center; background: #e8f5e9; padding: 15px; border-radius: 12px; border-left: 6px solid var(--success); margin-top: 20px; }
        .result-box img { width: 60px; height: 60px; border-radius: 50%; margin-right: 15px; border: 2px solid #fff; }
        .status-badge { background: var(--success); color: white; padding: 3px 10px; border-radius: 20px; font-size: 12px; display: inline-block; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .loading { text-align: center; color: #f59e0b; display: none; margin: 15px 0; font-weight: bold;}
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: left; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: bold;">SIS @ Ban Chiang Wittaya</div>
    <div id="user-display" style="font-size: 12px; cursor: pointer;" onclick="logout()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</div>
</div>

<div class="container">
    
    <div id="login-page" class="page active">
        <div class="card" style="text-align: center;">
            <h2 style="color: #1e56a0;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <p style="color: #666; font-size: 14px;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
            <input type="text" id="username" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏£‡∏π ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)">
            <input type="password" id="password" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
            <button class="login-btn" onclick="handleLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
            <p style="color: #dc3545; font-size: 13px; display: none;" id="login-error">‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
        </div>
    </div>

    <div id="scan-page" class="page">
        <div class="card">
            <h2 style="text-align: center; margin-top: 0;">üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏π)</h2>
            <div id="reader"></div>
            <div id="loading" class="loading">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
            
            <div id="result-box" class="result-box">
                <img id="student-img" src="" alt="">
                <div class="result-info">
                    <div id="status-badge" class="status-badge">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</div>
                    <h3 id="student-name" style="margin: 5px 0;">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                    <p style="margin: 0; font-size: 13px;">‡∏£‡∏´‡∏±‡∏™: <b id="student-id">...</b> | ‡∏ä‡∏±‡πâ‡∏ô: <b id="student-class">...</b></p>
                </div>
            </div>
        </div>
    </div>

    <div id="history-page" class="page">
        <div class="card">
            <h2>üìÖ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏ñ‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
            <p style="color: #666; font-size: 13px;">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p>
            <table id="history-table">
                <thead>
                    <tr><th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏´‡πâ‡∏≠‡∏á</th></tr>
                </thead>
                <tbody id="history-body">
                </tbody>
            </table>
        </div>
    </div>

    <div id="student-page" class="page">
        <div class="card" style="background: linear-gradient(135deg, #1e56a0, #2a6fcc); color: white;">
            <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>
            <h2 id="st-name-display">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h2>
            <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‚úÖ ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏™‡∏≠‡∏ö (‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô > 80%)</p>
        </div>
        <div class="card">
            <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
            <p style="color: #666; font-size: 13px;">(‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•)</p>
            <ul>
                <li>20/02/2026 - <b style="color: green;">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</b></li>
                <li>19/02/2026 - <b style="color: green;">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</b></li>
            </ul>
        </div>
    </div>

</div>

<div class="nav-menu" id="bottom-nav">
    <div class="nav-item active" id="nav-scan" onclick="switchPage('scan-page', this)">
        <span>üì∏</span><br>‡∏™‡πÅ‡∏Å‡∏ô
    </div>
    <div class="nav-item" id="nav-history" onclick="switchPage('history-page', this)">
        <span>üìÖ</span><br>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    </div>
</div>

<script>
    const GAS_API_URL = "https://script.google.com/macros/s/AKfycby3zyx9w_k1jBHmROtBt9GdfkQtPfuxRLo4H_VZtVoaqFpkvbReVH6upPyV-qGY3kc5/exec";
    let lastScannedId = "";
    let lastScanTime = 0;
    let html5QrcodeScanner = null;

    // --- üîê ‡∏£‡∏∞‡∏ö‡∏ö Login ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ JavaScript ---
    function handleLogin() {
        const u = document.getElementById('username').value;
        const p = document.getElementById('password').value;
        const err = document.getElementById('login-error');
        
        // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏ß‡∏£‡∏™‡πà‡∏á fetch ‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡πà Apps Script)
        if (u === "admin" && p === "1234") {
            // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Ñ‡∏£‡∏π
            err.style.display = 'none';
            document.getElementById('user-display').innerText = "‡∏Ñ‡∏£‡∏π‡∏≠‡∏±‡∏Ñ‡∏£‡πÄ‡∏î‡∏ä (‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö)";
            document.getElementById('bottom-nav').style.display = 'flex'; // ‡πÇ‡∏ä‡∏ß‡πå‡πÄ‡∏°‡∏ô‡∏π
            switchPage('scan-page', document.getElementById('nav-scan'));
            startScanner(); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏£‡∏π
        } else if (u === "6326" && p === "1234") {
            // ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
            err.style.display = 'none';
            document.getElementById('user-display').innerText = "‡∏î.‡∏ä.‡∏à‡∏≤‡∏£‡∏∏‡∏Å‡∏£ (‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö)";
            document.getElementById('bottom-nav').style.display = 'none'; // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏ô‡∏π
            document.getElementById('st-name-display').innerText = "‡∏î.‡∏ä.‡∏à‡∏≤‡∏£‡∏∏‡∏Å‡∏£ ‡∏´‡∏á‡∏™‡πå‡∏™‡∏¥‡∏á‡∏´‡πå";
            switchPage('student-page', null);
            stopScanner();
        } else {
            err.style.display = 'block';
        }
    }

    function logout() {
        document.getElementById('user-display').innerText = "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö";
        document.getElementById('bottom-nav').style.display = 'none';
        document.getElementById('username').value = "";
        document.getElementById('password').value = "";
        stopScanner();
        switchPage('login-page', null);
    }

    // --- üß≠ ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤ (Navigation) ---
    function switchPage(pageId, element) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        if(element) {
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
        }
        document.getElementById(pageId).classList.add('active');
    }

    // --- üì∏ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô ---
    function startScanner() {
        if(!html5QrcodeScanner) {
            html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
            html5QrcodeScanner.render(onScanSuccess);
        }
    }
    function stopScanner() {
        if(html5QrcodeScanner) {
            html5QrcodeScanner.clear();
            html5QrcodeScanner = null;
        }
    }

    function onScanSuccess(decodedText) {
        let now = Date.now();
        if (decodedText === lastScannedId && (now - lastScanTime) < 5000) return;
        
        lastScannedId = decodedText;
        lastScanTime = now;

        document.getElementById('result-box').style.display = 'none';
        document.getElementById('loading').style.display = 'block';

        fetch(GAS_API_URL + "?id=" + encodeURIComponent(decodedText))
            .then(res => res.json())
            .then(data => {
                document.getElementById('loading').style.display = 'none';
                if(data.status === "success" || data.status === "warning") {
                    document.getElementById('student-name').innerText = data.name;
                    document.getElementById('student-id').innerText = data.id;
                    document.getElementById('student-class').innerText = data.className;
                    document.getElementById('student-img').src = `https://ui-avatars.com/api/?name=${data.name}&background=random&color=fff&rounded=true`;
                    document.getElementById('result-box').style.display = 'flex';
                    addHistoryRow(data);
                } else {
                    alert(data.message);
                }
            })
            .catch(err => {
                document.getElementById('loading').style.display = 'none';
                alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ");
            });
    }

    function addHistoryRow(data) {
        const tbody = document.getElementById('history-body');
        const row = tbody.insertRow(0);
        const time = new Date().toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
        row.innerHTML = `<td>${time}</td><td>${data.name}</td><td>${data.className}</td>`;
    }
</script>

</body>
</html>
